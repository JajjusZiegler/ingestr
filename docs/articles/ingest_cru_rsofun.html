<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CRU climate forcing ingest â€¢ ingestr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="CRU climate forcing ingest">
<meta property="og:description" content="ingestr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ingestr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/calc_daytime_vpd.html">Calculate daytime VPD</a>
    </li>
    <li>
      <a href="../articles/example.html">Examples for ingestr</a>
    </li>
    <li>
      <a href="../articles/ingest_cru_rsofun.html">CRU climate forcing ingest</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/computationales/ingestr/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="ingest_cru_rsofun_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>CRU climate forcing ingest</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/computationales/ingestr/blob/master/vignettes/ingest_cru_rsofun.Rmd"><code>vignettes/ingest_cru_rsofun.Rmd</code></a></small>
      <div class="hidden name"><code>ingest_cru_rsofun.Rmd</code></div>

    </div>

    
    
<p>CRU TS provides monthly climate fields at 0.5 degree resolution from 1901 to today. Frequent updates are made available. CRU TS 4.05 contains data up to 2018. ingestr converts CRU variables to rsofun standard variables and units that can then be used as forcing for rsofun. The following describes what precursor variables are used for each rsofun standard variable (and how).</p>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th>rsofun standard variable</th>
<th>(Precursor) CRU variable name(s)</th>
<th>Remark</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>tmin</td>
<td>tmn</td>
<td></td>
</tr>
<tr class="even">
<td>tmax</td>
<td>tmx</td>
<td></td>
</tr>
<tr class="odd">
<td>prec</td>
<td>prc, wtd</td>
<td>Weather generator conserving monthly sums and number of monthly wet days</td>
</tr>
<tr class="even">
<td>vpd</td>
<td>vap, tmin, tmax</td>
<td>Using <code><a href="../reference/calc_vpd.html">calc_vpd()</a></code>
</td>
</tr>
<tr class="odd">
<td>ccov</td>
<td>cld</td>
<td></td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## get monthly data (no temporal downscaling - original extracted values)</span>
<span class="va">mdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest_bysite.html">ingest_bysite</a></span><span class="op">(</span>
  sitename  <span class="op">=</span> <span class="st">"CH-Lae"</span>,
  source    <span class="op">=</span> <span class="st">"cru"</span>,
  getvars   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"tmax"</span>, <span class="st">"tmin"</span>, <span class="st">"prec"</span>, <span class="st">"vpd"</span><span class="op">)</span>,
  dir       <span class="op">=</span> <span class="st">"~/data/cru/ts_4.05/"</span>,
  timescale <span class="op">=</span> <span class="st">"m"</span>,
  year_start <span class="op">=</span> <span class="fl">1901</span>,
  year_end  <span class="op">=</span> <span class="fl">2018</span>,
  lon       <span class="op">=</span> <span class="fl">8.365</span>,
  lat       <span class="op">=</span> <span class="fl">47.4781</span>,
  verbose   <span class="op">=</span> <span class="cn">FALSE</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## Warning in .varName(nc, varname, warn = warn): varname used is: tmn
## If that is not correct, you can set it to one of: tmn, stn</code></pre>
<pre><code>## Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if `.name_repair` is omitted as of tibble 2.0.0.
## Using compatibility `.name_repair`.</code></pre>
<pre><code>## Warning in .varName(nc, varname, warn = warn): varname used is: tmx
## If that is not correct, you can set it to one of: tmx, stn</code></pre>
<pre><code>## Warning in .varName(nc, varname, warn = warn): varname used is: pre
## If that is not correct, you can set it to one of: pre, stn</code></pre>
<pre><code>## Warning in .varName(nc, varname, warn = warn): varname used is: wet
## If that is not correct, you can set it to one of: wet, stn</code></pre>
<pre><code>## Warning in .varName(nc, varname, warn = warn): varname used is: vap
## If that is not correct, you can set it to one of: vap, stn</code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## get daily data (with temporal downscaling)</span>
<span class="va">ddf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest_bysite.html">ingest_bysite</a></span><span class="op">(</span>
  sitename  <span class="op">=</span> <span class="st">"CH-Lae"</span>,
  source    <span class="op">=</span> <span class="st">"cru"</span>,
  getvars   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"tmax"</span>, <span class="st">"tmin"</span>, <span class="st">"prec"</span>, <span class="st">"vpd"</span><span class="op">)</span>,
  dir       <span class="op">=</span> <span class="st">"~/data/cru/ts_4.05/"</span>,
  timescale <span class="op">=</span> <span class="st">"d"</span>,
  year_start <span class="op">=</span> <span class="fl">1901</span>,
  year_end  <span class="op">=</span> <span class="fl">2018</span>,
  lon       <span class="op">=</span> <span class="fl">8.365</span>,
  lat       <span class="op">=</span> <span class="fl">47.4781</span>,
  verbose   <span class="op">=</span> <span class="cn">FALSE</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## Warning in .varName(nc, varname, warn = warn): varname used is: tmn
## If that is not correct, you can set it to one of: tmn, stn</code></pre>
<pre><code>## Warning in .varName(nc, varname, warn = warn): varname used is: tmx
## If that is not correct, you can set it to one of: tmx, stn</code></pre>
<pre><code>## Warning in .varName(nc, varname, warn = warn): varname used is: pre
## If that is not correct, you can set it to one of: pre, stn</code></pre>
<pre><code>## Warning in .varName(nc, varname, warn = warn): varname used is: wet
## If that is not correct, you can set it to one of: wet, stn</code></pre>
<pre><code>## Warning in .varName(nc, varname, warn = warn): varname used is: vap
## If that is not correct, you can set it to one of: vap, stn</code></pre>
<div id="check-temporal-downscaling" class="section level2">
<h2 class="hasAnchor">
<a href="#check-temporal-downscaling" class="anchor"></a>Check temporal downscaling</h2>
<p>The temporal downscaling conserves monthly means. The following shows monthly tmin values aggregated from downscaled daily values versus values directly extracted from the original files.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mdf_test</span> <span class="op">&lt;-</span> <span class="va">ddf</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span>, month <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">summarise</span><span class="op">(</span>tmin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">tmin</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">rename</span><span class="op">(</span>tmin_agg <span class="op">=</span> <span class="va">tmin</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">left_join</span><span class="op">(</span><span class="va">mdf</span> <span class="op">%&gt;%</span> 
              <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, tmin_orig <span class="op">=</span> <span class="va">tmin</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'year'. You can override using the `.groups` argument.</code></pre>
<pre><code>## Joining, by = c("year", "month")</code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gg</span> <span class="op">&lt;-</span> <span class="va">mdf_test</span> <span class="op">%&gt;%</span> <span class="fu">analyse_modobs2</span><span class="op">(</span><span class="st">"tmin_orig"</span>, <span class="st">"tmin_agg"</span><span class="op">)</span></code></pre></div>
<pre><code>## Loading required package: ggplot2</code></pre>
<pre><code>## Loading required package: LSD</code></pre>
<pre><code>## 
## Attaching package: 'LSD'</code></pre>
<pre><code>## The following objects are masked from 'package:rbeni':
## 
##     colorpalette, complementarycolor, convertcolor, convertgrey,
##     daltonize, disco, distinctcolors, heatpairs, heatscatter,
##     heatscatterpoints</code></pre>
<pre><code>## Loading required package: ggthemes</code></pre>
<pre><code>## Loading required package: RColorBrewer</code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gg</span><span class="op">$</span><span class="va">gg</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Original monthly tmin (deg C)"</span>, y <span class="op">=</span> <span class="st">"Aggregated monthly tmin (deg C)"</span><span class="op">)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula 'y ~ x'</code></pre>
<p><img src="ingest_cru_rsofun_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>For precipitation, the temporal downscaling conserves monthly totals and distributes precipitation to the given number of wet days (also provided by CRU as the number of wet days per month).</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mdf_test</span> <span class="op">&lt;-</span> <span class="va">ddf</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span>, month <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">summarise</span><span class="op">(</span>prec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">prec</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">rename</span><span class="op">(</span>prec_agg <span class="op">=</span> <span class="va">prec</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">left_join</span><span class="op">(</span><span class="va">mdf</span> <span class="op">%&gt;%</span> 
              <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, prec_orig <span class="op">=</span> <span class="va">prec</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'year'. You can override using the `.groups` argument.</code></pre>
<pre><code>## Joining, by = c("year", "month")</code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gg</span> <span class="op">&lt;-</span> <span class="va">mdf_test</span> <span class="op">%&gt;%</span> <span class="fu">analyse_modobs2</span><span class="op">(</span><span class="st">"prec_orig"</span>, <span class="st">"prec_agg"</span><span class="op">)</span>
<span class="va">gg</span><span class="op">$</span><span class="va">gg</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Original monthly prec (mm)"</span>, y <span class="op">=</span> <span class="st">"Aggregated monthly prec (mm)"</span><span class="op">)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula 'y ~ x'</code></pre>
<p><img src="ingest_cru_rsofun_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>Monthly means are not conserved for VPD. This is because CRU TS provides vapour pressure (VAP) data and VPD is calculated by ingestr as <span class="math display">\[
VPD = (f(VAP, TMIN) + f(VAP, TMAX))/2
\]</span></p>
<p>Where <span class="math inline">\(f\)</span> is a non-linear function (<code><a href="../reference/calc_vpd.html">calc_vpd()</a></code>) and VAP, TMIN, and TMAX are either monthly mean values in case of <code>timescale = "m"</code> or daily values (conserved monthly means) in case of <code>timescale = "d"</code>,</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mdf_test</span> <span class="op">&lt;-</span> <span class="va">ddf</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span>, month <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">summarise</span><span class="op">(</span>vpd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">vpd</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">rename</span><span class="op">(</span>vpd_agg <span class="op">=</span> <span class="va">vpd</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">left_join</span><span class="op">(</span><span class="va">mdf</span> <span class="op">%&gt;%</span> 
              <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, vpd_orig <span class="op">=</span> <span class="va">vpd</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'year'. You can override using the `.groups` argument.</code></pre>
<pre><code>## Joining, by = c("year", "month")</code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gg</span> <span class="op">&lt;-</span> <span class="va">mdf_test</span> <span class="op">%&gt;%</span> <span class="fu">analyse_modobs2</span><span class="op">(</span><span class="st">"vpd_orig"</span>, <span class="st">"vpd_agg"</span><span class="op">)</span>
<span class="va">gg</span><span class="op">$</span><span class="va">gg</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Original monthly VPD (Pa)"</span>, y <span class="op">=</span> <span class="st">"Aggregated monthly VPD (Pa)"</span><span class="op">)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula 'y ~ x'</code></pre>
<p><img src="ingest_cru_rsofun_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
<div id="bias-correction-with-worldclim" class="section level2">
<h2 class="hasAnchor">
<a href="#bias-correction-with-worldclim" class="anchor"></a>Bias correction with WorldClim</h2>
<p>Bias correction based on high-resolution WorldClim 1970-2000 monthly climatology is available for variables temp, prec, and vpd.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## get monthly data (no temporal downscaling - original extracted values)</span>
<span class="va">mdf_corr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest_bysite.html">ingest_bysite</a></span><span class="op">(</span>
  sitename  <span class="op">=</span> <span class="st">"CH-Lae"</span>,
  source    <span class="op">=</span> <span class="st">"cru"</span>,
  getvars   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"temp"</span>, <span class="st">"tmin"</span>, <span class="st">"tmax"</span>, <span class="st">"prec"</span>, <span class="st">"vpd"</span>, <span class="st">"ccov"</span><span class="op">)</span>,
  dir       <span class="op">=</span> <span class="st">"~/data/cru/ts_4.05/"</span>,
  timescale <span class="op">=</span> <span class="st">"m"</span>,
  year_start <span class="op">=</span> <span class="fl">1901</span>,
  year_end  <span class="op">=</span> <span class="fl">2018</span>,
  lon       <span class="op">=</span> <span class="fl">8.365</span>,
  lat       <span class="op">=</span> <span class="fl">47.4781</span>,
  verbose   <span class="op">=</span> <span class="cn">FALSE</span>,
  settings  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>correct_bias <span class="op">=</span> <span class="st">"worldclim"</span>, dir_bias <span class="op">=</span> <span class="st">"~/data/worldclim"</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## Warning in .varName(nc, varname, warn = warn): varname used is: tmp
## If that is not correct, you can set it to one of: tmp, stn</code></pre>
<pre><code>## Warning in .varName(nc, varname, warn = warn): varname used is: tmn
## If that is not correct, you can set it to one of: tmn, stn</code></pre>
<pre><code>## Warning in .varName(nc, varname, warn = warn): varname used is: tmx
## If that is not correct, you can set it to one of: tmx, stn</code></pre>
<pre><code>## Warning in .varName(nc, varname, warn = warn): varname used is: pre
## If that is not correct, you can set it to one of: pre, stn</code></pre>
<pre><code>## Warning in .varName(nc, varname, warn = warn): varname used is: wet
## If that is not correct, you can set it to one of: wet, stn</code></pre>
<pre><code>## Warning in .varName(nc, varname, warn = warn): varname used is: vap
## If that is not correct, you can set it to one of: vap, stn</code></pre>
<pre><code>## Warning in .varName(nc, varname, warn = warn): varname used is: cld
## If that is not correct, you can set it to one of: cld, stn</code></pre>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## get daily data (with temporal downscaling)</span>
<span class="va">ddf_corr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ingest_bysite.html">ingest_bysite</a></span><span class="op">(</span>
  sitename  <span class="op">=</span> <span class="st">"CH-Lae"</span>,
  source    <span class="op">=</span> <span class="st">"cru"</span>,
  getvars   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"temp"</span>, <span class="st">"tmin"</span>, <span class="st">"tmax"</span>, <span class="st">"prec"</span>, <span class="st">"vpd"</span>, <span class="st">"ccov"</span><span class="op">)</span>,
  dir       <span class="op">=</span> <span class="st">"~/data/cru/ts_4.05/"</span>,
  timescale <span class="op">=</span> <span class="st">"d"</span>,
  year_start <span class="op">=</span> <span class="fl">1901</span>,
  year_end  <span class="op">=</span> <span class="fl">2018</span>,
  lon       <span class="op">=</span> <span class="fl">8.365</span>,
  lat       <span class="op">=</span> <span class="fl">47.4781</span>,
  verbose   <span class="op">=</span> <span class="cn">FALSE</span>,
  settings  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>correct_bias <span class="op">=</span> <span class="st">"worldclim"</span>, dir_bias <span class="op">=</span> <span class="st">"~/data/worldclim"</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## Warning in .varName(nc, varname, warn = warn): varname used is: tmp
## If that is not correct, you can set it to one of: tmp, stn</code></pre>
<pre><code>## Warning in .varName(nc, varname, warn = warn): varname used is: tmn
## If that is not correct, you can set it to one of: tmn, stn</code></pre>
<pre><code>## Warning in .varName(nc, varname, warn = warn): varname used is: tmx
## If that is not correct, you can set it to one of: tmx, stn</code></pre>
<pre><code>## Warning in .varName(nc, varname, warn = warn): varname used is: pre
## If that is not correct, you can set it to one of: pre, stn</code></pre>
<pre><code>## Warning in .varName(nc, varname, warn = warn): varname used is: wet
## If that is not correct, you can set it to one of: wet, stn</code></pre>
<pre><code>## Warning in .varName(nc, varname, warn = warn): varname used is: vap
## If that is not correct, you can set it to one of: vap, stn</code></pre>
<pre><code>## Warning in .varName(nc, varname, warn = warn): varname used is: cld
## If that is not correct, you can set it to one of: cld, stn</code></pre>
<p>Check conservation of precipitation means after bias correction.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mdf_test</span> <span class="op">&lt;-</span> <span class="va">ddf_corr</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span>, month <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">summarise</span><span class="op">(</span>prec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">prec</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">rename</span><span class="op">(</span>prec_agg <span class="op">=</span> <span class="va">prec</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">left_join</span><span class="op">(</span><span class="va">mdf_corr</span> <span class="op">%&gt;%</span> 
              <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, prec_orig <span class="op">=</span> <span class="va">prec</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'year'. You can override using the `.groups` argument.</code></pre>
<pre><code>## Joining, by = c("year", "month")</code></pre>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gg</span> <span class="op">&lt;-</span> <span class="va">mdf_test</span> <span class="op">%&gt;%</span> <span class="fu">analyse_modobs2</span><span class="op">(</span><span class="st">"prec_orig"</span>, <span class="st">"prec_agg"</span><span class="op">)</span>
<span class="va">gg</span><span class="op">$</span><span class="va">gg</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Original monthly prec (deg C)"</span>, y <span class="op">=</span> <span class="st">"Aggregated monthly prec (deg C)"</span><span class="op">)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula 'y ~ x'</code></pre>
<p><img src="ingest_cru_rsofun_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>Check conservation of VPD means after bias correction.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mdf_test</span> <span class="op">&lt;-</span> <span class="va">ddf_corr</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span>, month <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">summarise</span><span class="op">(</span>vpd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">vpd</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">rename</span><span class="op">(</span>vpd_agg <span class="op">=</span> <span class="va">vpd</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">left_join</span><span class="op">(</span><span class="va">mdf_corr</span> <span class="op">%&gt;%</span> 
              <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span>, vpd_orig <span class="op">=</span> <span class="va">vpd</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'year'. You can override using the `.groups` argument.</code></pre>
<pre><code>## Joining, by = c("year", "month")</code></pre>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gg</span> <span class="op">&lt;-</span> <span class="va">mdf_test</span> <span class="op">%&gt;%</span> <span class="fu">analyse_modobs2</span><span class="op">(</span><span class="st">"vpd_orig"</span>, <span class="st">"vpd_agg"</span><span class="op">)</span>
<span class="va">gg</span><span class="op">$</span><span class="va">gg</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Original monthly vpd (deg C)"</span>, y <span class="op">=</span> <span class="st">"Aggregated monthly vpd (deg C)"</span><span class="op">)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula 'y ~ x'</code></pre>
<p><img src="ingest_cru_rsofun_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
<div id="check-against-station-data" class="section level2">
<h2 class="hasAnchor">
<a href="#check-against-station-data" class="anchor"></a>Check against station data</h2>
<p>Comparison of bias-corrected data to FLUXNET site-level observations. For CH-Lae, this is available for 2004-2014. Visualize for three years (2012-2014). Get FLUXNET data.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ddf_fluxnet</span> <span class="op">&lt;-</span> <span class="fu">ingestr</span><span class="fu">::</span><span class="fu"><a href="../reference/ingest.html">ingest</a></span><span class="op">(</span>
  siteinfo  <span class="op">=</span> <span class="va">siteinfo_fluxnet2015</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">sitename</span> <span class="op">==</span> <span class="st">"CH-Lae"</span><span class="op">)</span>,
  source    <span class="op">=</span> <span class="st">"fluxnet"</span>,
  getvars   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>temp <span class="op">=</span> <span class="st">"TA_F_DAY"</span>, prec <span class="op">=</span> <span class="st">"P_F"</span>, vpd  <span class="op">=</span> <span class="st">"VPD_F_DAY"</span>, ppfd <span class="op">=</span> <span class="st">"SW_IN_F"</span>, patm <span class="op">=</span> <span class="st">"PA_F"</span><span class="op">)</span>,
  dir       <span class="op">=</span> <span class="st">"~/data/FLUXNET-2015_Tier1/20191024/DD/"</span>,
  settings  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>dir_hh <span class="op">=</span> <span class="st">"~/data/FLUXNET-2015_Tier1/20191024/HH/"</span>, getswc <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,
  timescale <span class="op">=</span> <span class="st">"d"</span>
  <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">unnest</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 4018 Columns: 6</code></pre>
<pre><code>## â”€â”€ Column specification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
## Delimiter: ","
## dbl  (5): VPD_F_DAY, VPD_F_DAY_QC, VPD_F_DAY_MDS, VPD_F_DAY_MDS_QC, VPD_DAY_ERA
## date (1): date</code></pre>
<pre><code>## 
## â„¹ Use `spec()` to retrieve the full column specification for this data.
## â„¹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre><code>## Warning: Unknown columns: ``</code></pre>
<p>Looks fine for temperature.</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ddf_fluxnet</span> <span class="op">%&gt;%</span> 
              <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op">%in%</span> <span class="fl">2012</span><span class="op">:</span><span class="fl">2014</span><span class="op">)</span>, 
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">temp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ddf_corr</span> <span class="op">%&gt;%</span> 
              <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op">%in%</span> <span class="fl">2012</span><span class="op">:</span><span class="fl">2014</span><span class="op">)</span>, 
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">temp</span><span class="op">)</span>,
            color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></code></pre></div>
<p><img src="ingest_cru_rsofun_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out</span> <span class="op">&lt;-</span> <span class="va">ddf_fluxnet</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="fu">year</span><span class="op">(</span><span class="va">date</span><span class="op">)</span>, month <span class="op">=</span> <span class="fu">month</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">summarise</span><span class="op">(</span>temp_fluxnet <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">left_join</span><span class="op">(</span><span class="va">ddf_corr</span> <span class="op">%&gt;%</span> 
              <span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="fu">year</span><span class="op">(</span><span class="va">date</span><span class="op">)</span>, month <span class="op">=</span> <span class="fu">month</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
              <span class="fu">group_by</span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span><span class="op">)</span> <span class="op">%&gt;%</span> 
              <span class="fu">summarise</span><span class="op">(</span>temp_cru_wc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">)</span>,
            by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"month"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">analyse_modobs2</span><span class="op">(</span><span class="st">"temp_fluxnet"</span>, <span class="st">"temp_cru_wc"</span><span class="op">)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'year'. You can override using the `.groups` argument.
## `summarise()` has grouped output by 'year'. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out</span><span class="op">$</span><span class="va">gg</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula 'y ~ x'</code></pre>
<p><img src="ingest_cru_rsofun_files/figure-html/unnamed-chunk-9-2.png" width="700"></p>
<p>Looks fine for precipitation. Compare monthly means - not bad at all!</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out</span> <span class="op">&lt;-</span> <span class="va">ddf_fluxnet</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="fu">year</span><span class="op">(</span><span class="va">date</span><span class="op">)</span>, month <span class="op">=</span> <span class="fu">month</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">summarise</span><span class="op">(</span>prec_fluxnet <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">prec</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">left_join</span><span class="op">(</span><span class="va">ddf_corr</span> <span class="op">%&gt;%</span> 
              <span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="fu">year</span><span class="op">(</span><span class="va">date</span><span class="op">)</span>, month <span class="op">=</span> <span class="fu">month</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
              <span class="fu">group_by</span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span><span class="op">)</span> <span class="op">%&gt;%</span> 
              <span class="fu">summarise</span><span class="op">(</span>prec_cru_wc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">prec</span><span class="op">)</span><span class="op">)</span>,
            by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"month"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">analyse_modobs2</span><span class="op">(</span><span class="st">"prec_fluxnet"</span>, <span class="st">"prec_cru_wc"</span><span class="op">)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'year'. You can override using the `.groups` argument.
## `summarise()` has grouped output by 'year'. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out</span><span class="op">$</span><span class="va">gg</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula 'y ~ x'</code></pre>
<p><img src="ingest_cru_rsofun_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>Looks fine for VPD</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ddf_fluxnet</span> <span class="op">%&gt;%</span> 
              <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op">%in%</span> <span class="fl">2012</span><span class="op">:</span><span class="fl">2014</span><span class="op">)</span>, 
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">vpd</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ddf_corr</span> <span class="op">%&gt;%</span> 
              <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op">%in%</span> <span class="fl">2012</span><span class="op">:</span><span class="fl">2014</span><span class="op">)</span>, 
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">vpd</span><span class="op">)</span>,
            color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></code></pre></div>
<p><img src="ingest_cru_rsofun_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out</span> <span class="op">&lt;-</span> <span class="va">ddf_fluxnet</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="fu">year</span><span class="op">(</span><span class="va">date</span><span class="op">)</span>, month <span class="op">=</span> <span class="fu">month</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">summarise</span><span class="op">(</span>vpd_fluxnet <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">vpd</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">left_join</span><span class="op">(</span><span class="va">ddf_corr</span> <span class="op">%&gt;%</span> 
              <span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="fu">year</span><span class="op">(</span><span class="va">date</span><span class="op">)</span>, month <span class="op">=</span> <span class="fu">month</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
              <span class="fu">group_by</span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span><span class="op">)</span> <span class="op">%&gt;%</span> 
              <span class="fu">summarise</span><span class="op">(</span>vpd_cru_wc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">vpd</span><span class="op">)</span><span class="op">)</span>,
            by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"month"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">analyse_modobs2</span><span class="op">(</span><span class="st">"vpd_fluxnet"</span>, <span class="st">"vpd_cru_wc"</span><span class="op">)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'year'. You can override using the `.groups` argument.
## `summarise()` has grouped output by 'year'. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out</span><span class="op">$</span><span class="va">gg</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula 'y ~ x'</code></pre>
<p><img src="ingest_cru_rsofun_files/figure-html/unnamed-chunk-11-2.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Benjamin Stocker.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
